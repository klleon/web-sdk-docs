---
sidebar_position: 5
title: 이벤트 처리
sidebar_label: 이벤트 처리
---

import { Table } from "@site/src/components/table/Table";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import {
  chatDataColumns,
  chatDataRows,
  statusEventArgumentColumns,
  statusEventArgumentRows,
  statusPossibleValuesColumns,
  statusPossibleValuesData,
  responseChatTypeValuesColumns,
  responseChatTypeValuesData,
} from "@site/src/data/usage";

# 이벤트 처리

Klleon Chat SDK는 실시간으로 발생하는 다양한 상태 변화와 데이터를 애플리케이션에 알리기 위해 커스텀 이벤트를 사용합니다. 이러한 이벤트를 구독하여 SDK의 동작에 맞춰 동적인 기능을 구현할 수 있습니다.

## 이벤트 리스너 등록 및 관리

SDK는 두 가지 주요 이벤트 스트림을 제공합니다: `Chat` 이벤트와 `Status` 이벤트.

### `KlleonChat.onChatEvent(callback)`

아바타 또는 사용자와 관련된 채팅 메시지 발생 시 호출되는 콜백 함수를 등록합니다. 이 이벤트를 활용하면 SDK에서 제공하는 `<chat-container>` UI 컴포넌트를 사용하지 않고도, 수신되는 `ChatData`를 기반으로 애플리케이션에 맞는 자체적인 채팅 인터페이스를 구현할 수 있습니다.

- **callback** (`(data: ChatData) => void`, 필수): `ChatData` 객체를 인자로 받는 콜백 함수입니다.

**사용 예시:**

```javascript
function handleChatMessage(chatData) {
  console.log("새 채팅 메시지:", chatData);
}

window.KlleonChat.onChatEvent(handleChatMessage);
```

#### `ChatData` 객체 및 `ResponseChatType` 상세

<Tabs groupId="chat-data-details">
  <TabItem value="chatdata" label="ChatData 객체 속성">
    `onChatEvent` 콜백을 통해 전달되는 `ChatData` 객체의 속성은 다음과 같습니다.
    <Table columns={chatDataColumns} data={chatDataRows} />
  </TabItem>
  <TabItem value="responsetype" label="ResponseChatType 값 상세">
    `ChatData` 객체의 `chat_type` 속성에 올 수 있는 값들과 그 의미는 다음과
    같습니다. (`BaseResponseChatType` 참고)
    <Table
      columns={responseChatTypeValuesColumns}
      data={responseChatTypeValuesData}
    />
  </TabItem>
</Tabs>

### `KlleonChat.onStatusEvent(callback)`

SDK 및 아바타의 주요 상태 변경 시 호출되는 콜백 함수를 등록합니다.

- **callback** (`(status: Status) => void`, 필수): 현재 SDK 또는 아바타의 상태를 나타내는 `Status` 문자열을 인자로 받는 콜백 함수입니다.

**사용 예시:**

```javascript
function handleSdkStatus(currentStatus) {
  console.log("SDK 상태 변경:", currentStatus);

  if (currentStatus === "VIDEO_CAN_PLAY") {
    console.log(
      "아바타 영상 재생 준비 완료! 이제 다른 SDK 메서드를 사용할 수 있습니다."
    );
    // 예: 메시지 입력 UI 활성화
    // document.getElementById('message-input').disabled = false;
  } else if (currentStatus.startsWith("ERROR_")) {
    // 예시: 오류 상태 처리
    console.error("SDK 오류 발생:", currentStatus);
  }
}

window.KlleonChat.onStatusEvent(handleSdkStatus);
```

:::caution SDK 메서드 사용 전제 조건
대부분의 SDK 메서드 (예: 메시지 전송, STT 기능 등)는 아바타와 정상적으로 연결되어 **영상 재생이 가능한 상태(`VIDEO_CAN_PLAY`)일 때 호출**해야 합니다. 이 상태는 `onStatusEvent`를 통해 전달되는 상태 값으로 확인할 수 있습니다. `VIDEO_CAN_PLAY` 상태가 아닐 때 메서드를 호출하면 예상대로 동작하지 않거나 오류가 발생할 수 있습니다.

`KlleonChat.init()` 및 이벤트 리스너 등록 메서드(`onChatEvent`, `onStatusEvent`)는 이 전제 조건에서 제외됩니다.
:::

#### `Status` 이벤트 인자 상세

`onStatusEvent` 콜백을 통해 전달되는 인자는 다음과 같습니다.

<Table columns={statusEventArgumentColumns} data={statusEventArgumentRows} />

#### `Status` 값 상세

`onStatusEvent` 콜백을 통해 전달되는 `Status` 문자열의 주요 값들과 그 의미는 다음과 같습니다. (`BaseStatus` 타입 참고)

<Table columns={statusPossibleValuesColumns} data={statusPossibleValuesData} />

:::info 콜백 재등록
`onChatEvent` 또는 `onStatusEvent`를 동일한 이벤트 타입에 대해 여러 번 호출하면, 마지막으로 등록된 콜백 함수만 활성화됩니다. 즉, 새 콜백을 등록하면 이전 콜백은 자동으로 해제됩니다. 명시적인 `off` 메서드는 제공되지 않습니다.
:::
