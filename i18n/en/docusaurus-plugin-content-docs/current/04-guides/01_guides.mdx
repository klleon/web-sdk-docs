---
id: guides
sidebar_position: 3
title: Development Guide
sidebar_label: Guides
---

### 1. Permission Management
- Always check permissions before SDK initialization
- Handle permission denials with user-friendly messages
- Provide clear rationale for required permissions
- Test permission flows across different Android versions

```kotlin
private fun showPermissionRationale() {
    Toast.makeText(
        this,
        "Audio permission is required for this app to function properly.",
        Toast.LENGTH_LONG
    ).show()
}
```

### 2. Resource Management
- Call `finish()` to clean up resources when SDK usage is complete
- Copy assets to cache directory for better performance
- Handle file I/O operations with proper error handling
- Clean up resources in `onDestroy()`

```kotlin
override fun onDestroy() {
    super.onDestroy()
    klleonOndeviceSdk.finish()
}
```

### 3. State Observation
- Use ViewModel to observe SDK state changes
- Collect state updates in coroutine scope
- Safely parse JSON responses with try-catch blocks
- Handle state updates on main thread for UI changes

### 4. Error Handling
- Wrap SDK method calls in try-catch blocks
- Log errors appropriately for debugging
- Provide user feedback for failed operations
- Validate inputs before SDK method calls

```kotlin
fun safeOperation() {
    try {
        klleonOndeviceSdk.sendMessage(message)
    } catch (e: Exception) {
        Log.e("SDK", "Operation failed", e)
        showUserError("Operation failed. Please try again.")
    }
}
```

### 5. UI Integration
- Use `AndroidView` in Compose to integrate `KlleonSdkView`
- Ensure view is properly initialized before SDK method calls
- Handle view lifecycle appropriately
- Test UI across different screen sizes and orientations

## Performance Optimization


### Memory Management
```kotlin
// Use remember in Compose to prevent object recreation
val vpPath = remember { File(context.cacheDir, "loop_sample.mp4").absolutePath }
```

### Threading
```kotlin
// Use appropriate coroutine scope for state observation
viewModelScope.launch {
    klleonOndeviceSdk.sdkState.collect { state ->
        // Handle state updates
    }
}
```

## Troubleshooting

### Common Issues

#### 1. Permission Denied
**Problem**: `RECORD_AUDIO` permission not granted

**Solution**: 
- Verify permission is declared in `AndroidManifest.xml`
- Check permission handling logic
- Test across different Android versions

#### 2. SDK State Not Updating
**Problem**: State observation not working

**Solution**:
- Verify state observation is properly set up in ViewModel
- Check if coroutine scope is active
- Ensure state collection has started

#### 3. View Not Ready
**Problem**: `KlleonSdkView` not initialized before `play()` call

**Solution**:
- Verify view initialization in `AndroidView` factory
- Enable buttons only when view is ready
- Add null checks before SDK method calls

### Debugging Tips

#### State Monitoring
```kotlin
// Monitor all state changes
klleonOndeviceSdk.sdkState.collect { state ->
    Log.d("SDKState", "State update: $state")
    
    try {
        val json = JSONObject(state)
        val message = json.getString("message")
        val type = json.optString("type", "unknown")
        Log.d("SDKState", "Parsed - Type: $type, Message: $message")
    } catch (e: Exception) {
        Log.w("SDKState", "Failed to parse state JSON", e)
    }
}
```

## Testing Strategy

### Unit Tests
```kotlin
@Test
fun testAssetCopying() {
    // Test asset file copying logic
    val testFile = File(context.cacheDir, "test.mp4")
    copyAssetToCache("test.mp4")
    assertTrue("Asset file should exist", testFile.exists())
}
```

### Integration Tests
```kotlin
@Test
fun testSDKInitialization() {
    val sdk = KlleonOndeviceSdk()
    assertNotNull("SDK should be initialized", sdk)
    
    // Test state observation
    val states = mutableListOf<String>()
    sdk.sdkState.take(1).collect { state ->
        states.add(state)
    }
    
    assertTrue("Should receive initial state", states.isNotEmpty())
}
```

### UI Tests
```kotlin
@Test
fun testPlayButtonEnabled() {
    composeTestRule.setContent {
        WorkerScreen(klleonOndeviceSdk = mockSdk)
    }
    
    // Initially disabled
    composeTestRule
        .onNodeWithText("Play")
        .assertIsNotEnabled()
    
    // Should be enabled after view initialization
    composeTestRule.waitUntil {
        composeTestRule
            .onNodeWithText("Play")
            .isEnabled()
    }
}
```